<!DOCTYPE html>
<html lang="es" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Monitoreo Energético Inteligente</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/smoothie/1.34.0/smoothie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="assets/styles-modern.css">
    <link rel="stylesheet" href="assets/analytics-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <header class="header">
        <div class="header-content">
            <h1><i class="fas fa-bolt"></i> Dashboard Energético Inteligente</h1>

            <div class="theme-toggle">
                <span><i class="fas fa-sun"></i></span>
                <label class="theme-switch">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
                <span><i class="fas fa-moon"></i></span>
            </div>

            <div class="header-buttons">
                <button id="btn3DView" class="btn-glass"><i class="fas fa-cube"></i> Vista 3D</button>
                <button id="btnAnalitica" class="btn-glass"><i class="fas fa-chart-bar"></i> Análisis OLAP</button>
                <button id="btnAgregarOficina" class="btn-glass"><i class="fas fa-plus"></i> Oficina</button>
                <button id="btnConfigSistema" class="btn-glass"><i class="fas fa-cog"></i> Configuración</button>
            </div>
        </div>
    </header>

    <div class="container">
        <aside class="sidebar">
            <!-- Panel de Resumen General Mejorado -->
            <div class="stats-card glass-card animate-in">
                <h3><i class="fas fa-chart-pie"></i> Resumen General</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-bolt"></i> Consumo Total</span>
                        <span class="info-value" id="totalConsumption">0 kWh</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-dollar-sign"></i> Costo Total</span>
                        <span class="info-value" id="totalCost">$0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-building"></i> Oficinas Activas</span>
                        <span class="info-value" id="activeOffices">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-piggy-bank"></i> Ahorro Mensual</span>
                        <span class="info-value" id="monthlySavings">0%</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-leaf"></i> CO2 Evitado</span>
                        <span class="info-value" id="co2Saved">0 kg</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-clock"></i> Tiempo Activo</span>
                        <span class="info-value" id="uptime">0h</span>
                    </div>
                </div>
            </div>

            <!-- Gráfico de Consumo en Tiempo Real -->
            <div class="chart-container glass-card">
                <h3><i class="fas fa-chart-line"></i> Consumo en Tiempo Real</h3>
                <canvas id="mainChart" width="400" height="200"></canvas>
            </div>

            <!-- Nuevos Gráficos Multidimensionales -->
            <div class="chart-container glass-card">
                <h3><i class="fas fa-chart-bar"></i> Análisis por Dispositivo</h3>
                <canvas id="deviceChart" width="400" height="200"></canvas>
            </div>

            <div class="chart-container glass-card">
                <h3><i class="fas fa-thermometer-half"></i> Temperaturas</h3>
                <canvas id="tempChart" width="400" height="200"></canvas>
            </div>

            <!-- Panel de Eventos Mejorado -->
            <div class="events-panel glass-card">
                <h3><i class="fas fa-bell"></i> Eventos Recientes</h3>
                <div id="eventsList" class="events-list">
                    <div class="event-placeholder">
                        <i class="fas fa-inbox"></i><br>
                        Esperando eventos...
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <!-- Resumen Rápido de Oficinas -->
            <div class="quick-stats glass-card">
                <h3><i class="fas fa-tachometer-alt"></i> Resumen Rápido por Oficina</h3>
                <div id="quickStatsGrid" class="quick-stats-grid">
                    <!-- Se llenará dinámicamente -->
                </div>
            </div>

            <!-- NUEVO: Paneles de Analytics CRISP-DM y OLAP -->
            <div id="analytics-panels">
                <div class="crispdm-panel glass-card">
                    <h3><i class="fas fa-brain"></i> Análisis Predictivo CRISP-DM</h3>
                    <div class="crispdm-phases">
                        <div class="crispdm-phase phase-business">
                            <h4><i class="fas fa-briefcase"></i> Comprensión del Negocio</h4>
                            <div id="business-objectives"></div>
                        </div>
                        <div class="crispdm-phase phase-data">
                            <h4><i class="fas fa-database"></i> Análisis de Datos</h4>
                            <div id="data-quality-metrics"></div>
                        </div>
                        <div class="crispdm-phase phase-modeling">
                            <h4><i class="fas fa-chart-line"></i> Modelado Predictivo</h4>
                            <div id="predictive-models"></div>
                        </div>
                    </div>
                    <div id="crispdm-recommendations" class="recommendations-container"></div>
                    <div id="predictive-metrics" class="metrics-grid"></div>
                </div>

                <div class="crispdm-panel glass-card">
                    <h3><i class="fas fa-cubes"></i> Cubo OLAP Multidimensional</h3>
                    <div id="olap-interface">
                        <div class="olap-controls">
                            <div class="dimension-selector">
                                <label>Dimensión X:</label>
                                <select id="olap-axis-x">
                                    <option value="tiempo.hora">Hora</option>
                                    <option value="ubicacion.oficina">Oficina</option>
                                    <option value="dispositivo.categoria">Categoría</option>
                                    <option value="operacional.uso">Uso</option>
                                </select>
                            </div>
                            <div class="dimension-selector">
                                <label>Dimensión Y:</label>
                                <select id="olap-axis-y">
                                    <option value="consumo_kwh">Consumo kWh</option>
                                    <option value="costo_total">Costo Total</option>
                                    <option value="eficiencia">Eficiencia</option>
                                    <option value="corriente_promedio">Corriente</option>
                                </select>
                            </div>
                            <div class="dimension-selector">
                                <label>Medida:</label>
                                <select id="olap-measure">
                                    <option value="sum">Suma</option>
                                    <option value="avg">Promedio</option>
                                    <option value="max">Máximo</option>
                                    <option value="min">Mínimo</option>
                                </select>
                            </div>
                            <button class="btn-glass" onclick="window.olapEngine.generateOLAPView()">
                                <i class="fas fa-chart-bar"></i> Generar Vista
                            </button>
                        </div>
                        <div id="olap-visualization" class="olap-visualization">
                            <!-- Aquí se renderizarán los gráficos OLAP -->
                        </div>
                    </div>
                    <div id="mdx-query-interface" class="mdx-interface">
                        <h4><i class="fas fa-code"></i> Consultas MDX Avanzadas</h4>
                        <textarea class="mdx-editor"
                            placeholder="SELECT {[Measures].[Consumo]} ON COLUMNS FROM [Cube] WHERE [Tiempo].[2024]"></textarea>
                        <div class="form-actions">
                            <button class="btn-glass" onclick="window.olapEngine.executeMDXQuery()">
                                <i class="fas fa-play"></i> Ejecutar MDX
                            </button>
                            <button class="btn-glass" onclick="window.olapEngine.showMDXExamples()">
                                <i class="fas fa-lightbulb"></i> Ejemplos
                            </button>
                        </div>
                        <div id="mdx-results" class="mdx-results">
                            <div class="results-placeholder">
                                <i class="fas fa-database"></i>
                                <p>Los resultados de las consultas MDX aparecerán aquí</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Grid Principal de Oficinas (existente) -->
            <div class="section-header">
                <h2><i class="fas fa-building"></i> Monitoreo Detallado por Oficina</h2>
                <div class="view-controls">
                    <button id="btnCompactView" class="btn-glass small"><i class="fas fa-th"></i> Compacto</button>
                    <button id="btnDetailedView" class="btn-glass small active"><i class="fas fa-list"></i>
                        Detallado</button>
                </div>
            </div>

            <div class="offices-grid" id="sectoresGrid">
                <div class="loading-card glass-card">
                    <h3><i class="fas fa-sync fa-spin"></i> Cargando oficinas...</h3>
                    <p>Conectando con el sistema de monitoreo</p>
                </div>
            </div>

            <!-- Grid Principal de Oficinas -->
            <div class="section-header">
                <h2><i class="fas fa-building"></i> Monitoreo Detallado por Oficina</h2>
                <div class="view-controls">
                    <button id="btnCompactView" class="btn-glass small"><i class="fas fa-th"></i> Compacto</button>
                    <button id="btnDetailedView" class="btn-glass small active"><i class="fas fa-list"></i>
                        Detallado</button>
                </div>
            </div>

            <div class="offices-grid" id="sectoresGrid">
                <div class="loading-card glass-card">
                    <h3><i class="fas fa-sync fa-spin"></i> Cargando oficinas...</h3>
                    <p>Conectando con el sistema de monitoreo</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para Análisis OLAP -->
    <div id="modalAnalitica" class="modal-overlay">
        <div class="modal glass-card large">
            <h3><i class="fas fa-chart-network"></i> Análisis Multidimensional OLAP</h3>
            <div class="olap-controls">
                <div class="form-group">
                    <label>Dimensión X</label>
                    <select id="olapDimensionX">
                        <option value="time">Tiempo</option>
                        <option value="office">Oficina</option>
                        <option value="device">Dispositivo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Dimensión Y</label>
                    <select id="olapDimensionY">
                        <option value="consumption">Consumo</option>
                        <option value="cost">Costo</option>
                        <option value="temperature">Temperatura</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Métrica</label>
                    <select id="olapMetric">
                        <option value="sum">Suma</option>
                        <option value="avg">Promedio</option>
                        <option value="max">Máximo</option>
                    </select>
                </div>
            </div>
            <div class="chart-container-large">
                <canvas id="olapChart" width="600" height="300"></canvas>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-glass" id="btnCancelarAnalitica">Cerrar</button>
                <button type="button" class="btn-glass primary" id="btnExportAnalitica">
                    <i class="fas fa-download"></i> Exportar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Agregar Oficina -->
    <div id="modalAgregarOficina" class="modal-overlay">
        <div class="modal glass-card">
            <h3><i class="fas fa-building"></i> Agregar Nueva Oficina</h3>
            <form id="formAgregarOficina">
                <div class="form-group">
                    <label for="inputNombreOficina">Nombre del Sector</label>
                    <input type="text" id="inputNombreOficina" required pattern="[A-Za-z0-9]+" maxlength="3"
                        placeholder="Ej: A01">
                </div>
                <div class="form-group">
                    <label for="inputSectorOficina">Sector/Departamento</label>
                    <input type="text" id="inputSectorOficina" required placeholder="Ej: Informática">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-glass" id="btnCancelarAgregarOficina">Cancelar</button>
                    <button type="submit" class="btn-glass primary">Agregar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Configuración del Sistema -->
    <div id="modalConfigSistema" class="modal-overlay">
        <div class="modal glass-card">
            <h3><i class="fas fa-cogs"></i> Configuración del Sistema</h3>
            <form id="formConfigSistema">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="horarioInicio">Horario Inicio</label>
                        <input type="time" id="horarioInicio" name="horarioInicio" required value="08:00">
                    </div>
                    <div class="form-group">
                        <label for="horarioFin">Horario Fin</label>
                        <input type="time" id="horarioFin" name="horarioFin" required value="20:00">
                    </div>
                    <div class="form-group">
                        <label for="tempAire">Temperatura AC (°C)</label>
                        <input type="number" id="tempAire" name="tempAire" step="0.1" required value="25.0">
                    </div>
                    <div class="form-group">
                        <label for="umbralCorriente">Umbral Corriente (A)</label>
                        <input type="number" id="umbralCorriente" name="umbralCorriente" step="0.01" required
                            value="21.5">
                    </div>
                    <div class="form-group">
                        <label for="voltaje">Voltaje (V)</label>
                        <input type="number" id="voltaje" name="voltaje" step="0.1" required value="220.0">
                    </div>
                    <div class="form-group">
                        <label for="costoKwh">Costo por kWh ($)</label>
                        <input type="number" id="costoKwh" name="costoKwh" step="0.001" required value="0.25">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-glass" id="btnCancelarConfigSistema">Cancelar</button>
                    <button type="submit" class="btn-glass primary">Guardar Configuración</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notificaciones Toast -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="assets/theme-toggle.js"></script>
    <script src="assets/dashboard-enhanced.js"></script>
    <!-- NUEVO: Scripts de Analytics -->
    <script src="assets/crisp-dm-analytics.js"></script>
    <script src="assets/olap-multidimensional.js"></script>
</body>

</html>